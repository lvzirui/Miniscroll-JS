/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.3.3
 *		update 1.3.3 | 09/11/2016 - add suport for npm modules, amd
 *    	update 1.3.0 | 25/08/2015 - add automatic get zindex
 *		update 1.2.9 | 10/09/2013 - fix multidimensional scrollwheel
 *		update 1.2.9 | 10/09/2013 - fix error in the scroll when the position is relative or absolute
 *		update 1.2.9 | 10/09/2013 - fix updating on the x axis
 *		update 1.2.8 | 03/09/2013 - add turn off mousewheel, ex: { mousewheel: true }
 *		update 1.2.7 | 03/09/2013 - add scrollTo, now its posible scroll to a custom position
 *		update 1.2.6 | 21/06/2013 - fix bug the whole scrollbar (not just the handler part) moves down when I drag it.
 *		update 1.2.5 | 18/05/2013 - fix bug thumb position with arrow keys
 * 		update 1.2.4 | 18/05/2013 - fix error it's time to catching the width and height
 * 		update 1.2.3 | 18/05/2013 - fix scrollbar position "x"
 * 		update 1.2.2 | 17/05/2013 - Key event added, now you can press the key down and key up for scrolling
 * 		update 1.2.1 | 15/05/2013 - Touch event added, now works for ipad, iphone and android
 */
!function(a,b){"object"==typeof exports?exports=module.exports=b():"function"==typeof define&&define.amd?define("Miniscroll",b):a.Miniscroll=b()}(this,function(){var a="prototype";return Miniscroll=function(a,b){this.type="",this.is="static",this.target=this.getElement(a),this.container,this.tracker,this.thumb,this.thumb_delta=Point(0,0),this.thumb_pos=Point(0,0),this.touch=Point(0,0),this.settings=b,this.percent,this.keypos_thumb=Point(0,0),this.scrolling=!1,this.preventScrolling=!1,this.turnOffWheel=!0,this.initializing()},Point=function(a,b){return this instanceof Point?(this.x=a?a:0,this.y=b?b:0,this):new Point(a,b)},Miniscroll[a].initializing=function(){this.buildScrollbar(),this.buildScrollbarTracker(),this.buildScrolbarThumb(),this.settings.isKeyEvent="undefined"==typeof this.settings.isKeyEvent||this.settings.isKeyEvent,this.turnOffWheel="undefined"==typeof this.settings.turnOffWheel?this.turnOffWheel:this.settings.turnOffWheel,this.settings.isKeyEvent&&this.addKeyBoardEvent(),this.setupEventHandler(),this.setupTouchEvent();var a=this;window.setInterval(function(){a.update()},10)},Miniscroll[a].buildScrollbar=function(){var a=this.target.id?this.target.id:this.target.className;this.container=this.create(this.target,"div",{class:"miniscroll-container",id:"miniscroll-"+a});var b=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,c=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,d=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),e=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:("x"===this.settings.axis?c:this.settings.size)+"px",height:("y"===this.settings.axis?b:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:e)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:d)+"px",zIndex:this.getZindex(this.target)})},Miniscroll[a].buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{class:"miniscroll-tracker"});var a="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,b="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:a+"px",height:b+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})},Miniscroll[a].buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{class:"miniscroll-thumb"});var a=Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),a=Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),b=Point(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?a.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?a.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:"0px",left:"0px",width:("x"===this.settings.axis?b.x:this.settings.size)+"px",height:("y"===this.settings.axis?b.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})},Miniscroll[a].setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress),this.bind(this.tracker,"mousedown",this.onScrollTrackerPress),this.turnOffWheel&&this.bind(this.target,"mousewheel",this.onScrollThumbWheel)},Miniscroll[a].setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart),this.bind(this.target,"touchmove",this.onScrollTouchMove)},Miniscroll[a].updateContainerPosition=function(){this.is=this.getCss(this.target,"position"),"relative"===this.is||"absolute"===this.is?"y"===this.settings.axis?(this.container.style.top=this.target.scrollTop+"px",this.container.style.left=this.offset(this.target).width-this.settings.size+"px"):(this.container.style.top=this.offset(this.target).height-this.settings.size+"px",this.container.style.left=this.target.scrollLeft+"px"):"y"===this.settings.axis?this.container.style.top=this.offset(this.target).top+"px":this.container.style.left=this.offset(this.target).left+"px"},Miniscroll[a].setScrubPosition=function(a){var b=this.offset(this.container).width,c=this.offset(this.container).height,d=this.offset(this.thumb).width,e=this.offset(this.thumb).height;this.thumb_pos=Point(Math.round((b-d)*a),Math.round((c-e)*a)),"y"===this.settings.axis?this.thumb.style.top=Math.round(this.thumb_pos.y)+"px":this.thumb.style.left=Math.round(this.thumb_pos.x)+"px"},Miniscroll[a].addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1"),this.css(this.target,{outline:"none"}),this.bind(this.target,"focus",function(a,b){!("onkeydown"in b)&&"onkeydown"in document&&(b=document),this.bind(b,"keydown",function(a){if(a.target==this.target){var e,b=a.keyCode||a.which,c={left:37,up:38,right:39,down:40},d=!0;switch(b){case c.up:0!==this.percent&&(this.keypos_thumb.y-=10);break;case c.down:1!==this.percent&&(this.keypos_thumb.y+=10);break;case c.left:0!==this.percent&&(this.keypos_thumb.x-=10);break;case c.right:1!==this.percent&&(this.keypos_thumb.x+=10);break;default:d=!1}"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.keypos_thumb.y,e=[38,40]):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.keypos_thumb.x,e=[37,39]),this.percent>=1&&b==e[1]||this.percent<=0&&b==e[0]?this.preventScrolling=!0:this.preventScrolling=!1,!this.preventScrolling&&d&&this.stopEvent(a),this.updateContainerPosition()}})}),this.bind(this.target,"click",function(a,b){if(a.target==this.target){try{document.activeElement=b}catch(a){}b.focus()}})},Miniscroll[a].onScrollTouchStart=function(a){var b=a.touches[0];this.scrolling=!0,this.touch=Point(b.pageX,b.pageY),this.bind(this.target,"touchend",this.onScrollTouchEnd)},Miniscroll[a].onScrollTouchMove=function(a){var b=a.touches[0];a.preventDefault();var c=Point(this.touch.x-b.pageX,this.touch.y-b.pageY);this.touch=Point(b.pageX,b.pageY),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=this.target.scrollTop+c.y):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=this.target.scrollLeft+c.x),this.updateContainerPosition()},Miniscroll[a].onScrollTouchEnd=function(a){this.scrolling=!1,this.unbind(this.target,"touchend",this.onScrollTouchEnd)},Miniscroll[a].onScrollThumbPress=function(a){a=a?a:window.event,this.stopEvent(a),this.scrolling=!0,this.thumb_delta=Point(this.thumb_pos.x-this.mouse(a).x,this.thumb_pos.y-this.mouse(a).y),this.bind(document,"mousemove",this.onScrollThumbUpdate),this.bind(document,"mouseup",this.onScrollThumbRelease),this.updateContainerPosition()},Miniscroll[a].onScrollThumbUpdate=function(a){return a=a?a:window.event,this.stopEvent(a),!!this.scrolling&&(this.thumb_pos=Point(this.mouse(a).x+this.thumb_delta.x,this.mouse(a).y+this.thumb_delta.y),this.thumb_pos=Point(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y))),this.percent=Point(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight)),this.percent=Point(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y))),"y"===this.settings.axis?(this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)):(this.thumb.style.left=Math.round(this.thumb_pos.x)+"px",this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)),this.keypos_thumb=Point(this.target.scrollLeft,this.target.scrollTop),void this.updateContainerPosition())},Miniscroll[a].onScrollThumbWheel=function(a){a=a?a:window.event;var h,b=a||window.event,d=([].slice.call(arguments,1),0),f=0,g=0;if(b.wheelDelta&&(d=b.wheelDelta/120),b.detail&&(d=-b.detail/3),g=d,f=d,b.deltaMode&&(g=-b.deltaY/3,f=-b.deltaX/3),void 0!==b.axis&&b.axis===b.HORIZONTAL_AXIS&&(g=0,f=-1*d),void 0!==b.wheelDeltaY&&(g=b.wheelDeltaY/120),void 0!==b.wheelDeltaX&&(f=-1*b.wheelDeltaX/120),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.setScrubPosition(this.percent),this.target.scrollTop=Math.round(this.target.scrollTop-10*g),h=g):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.setScrubPosition(this.percent),this.target.scrollLeft=Math.round(this.target.scrollLeft-10*f),h=f),this.percent>=1&&h<0||this.percent<=0&&h>0||0==h?this.preventScrolling=!0:this.preventScrolling=!1,this.preventScrolling||this.stopEvent(a),this.keypos_thumb=Point(this.target.scrollLeft,this.target.scrollTop),document.createEvent){var i=document.createEvent("HTMLEvents");i.initEvent("scroll",!0,!1),this.target.dispatchEvent(i)}else{var i=document.createEventObject();this.target.fireEvent("onscroll",i)}this.updateContainerPosition()},Miniscroll[a].onScrollThumbRelease=function(a){a=a?a:window.event,this.stopEvent(a),this.scrolling=!1,this.unbind(document,"mousemove",this.onScrollThumbUpdate),this.unbind(document,"mouseup",this.onScrollThumbRelease)},Miniscroll[a].onScrollTrackerPress=function(a){var b=this.mouse(a).y-this.offset(this.container).top;this.scrolling=!0,this.scrollTo(b)},Miniscroll[a].scrollTo=function(a){var b=Math.max(0,Math.min(this.offset(this.target).height-this.offset(this.thumb).height,a));"y"===this.settings.axis&&(this.thumb_pos.y=b,this.thumb.style.top=Math.round(this.thumb_pos.y)+"px",this.target.scrollTop=b,this.scrolling=!1)},Miniscroll[a].update=function(){"y"===this.settings.axis?this.target.scrollHeight===this.offset(this.target).height?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"}):this.target.scrollWidth===this.offset(this.target).width?this.css(this.container,{visibility:"hidden"}):this.css(this.container,{visibility:"visible"});var a=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height,b=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width,c=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size),d=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:("x"===this.settings.axis?b:this.settings.size)+"px",height:("y"===this.settings.axis?a:this.settings.size)+"px",top:("y"===this.settings.axis?this.offset(this.target).top:d)+"px",left:("x"===this.settings.axis?this.offset(this.target).left:c)+"px"});var e="x"===this.settings.axis?this.offset(this.container).width:this.settings.size,f="y"===this.settings.axis?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:e+"px",height:f+"px"});var g=Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight),h=Point(void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?g.x:this.settings.sizethumb,void 0===this.settings.sizethumb||"auto"===this.settings.sizethumb?g.y:this.settings.sizethumb);this.css(this.thumb,{width:("x"===this.settings.axis?h.x:this.settings.size)+"px",height:("y"===this.settings.axis?h.y:this.settings.size)+"px"}),"y"===this.settings.axis?(this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight),this.scrolling||this.setScrubPosition(this.percent)):(this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth),this.scrolling||this.setScrubPosition(this.percent)),this.updateContainerPosition()},Miniscroll[a].getElement=function(a){var b;if(a===window||a===document||"body"===a||"body, html"===a)return document.body;if("string"==typeof a||a instanceof String){var b,d=a.replace(/^\s+/,"").replace(/\s+$/,"");if(d.indexOf("#")>-1){this.type="id";var e=d.split("#");b=document.getElementById(e[1])}if(d.indexOf(".")>-1){this.type="class";for(var e=d.split("."),f=document.getElementsByTagName("*"),g=f.length,j=0;j<g;j++)f[j].className&&f[j].className.toString().match(new RegExp("(^|\\s)"+e[1]+"(\\s|$)"))&&(b=f[j])}return b}return a},Miniscroll[a].create=function(a,b,c){var d=document.createElement(b);if(c){for(var e in c)c.hasOwnProperty(e)&&d.setAttribute(e,c[e]);a.appendChild(d)}return d},Miniscroll[a].css=function(a,arguments){for(var b in arguments)"opacity"===b?(a.style.filter="alpha(opacity="+100*arguments[b]+")",a.style.KhtmlOpacity=arguments[b],a.style.MozOpacity=arguments[b],a.style.opacity=arguments[b]):a.style[b]=arguments[b]},Miniscroll[a].getCss=function(a,b){var c;return c=window.getComputedStyle?window.getComputedStyle(a).getPropertyValue(b):document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle.getPropertyValue(b):a.currentStyle?a.currentStyle[b]:a.style[b]},Miniscroll[a].offset=function(a){var b=a.offsetTop,c=a.offsetLeft,d=a.offsetHeight;"undefined"==typeof a.offsetHeight&&(d=parseInt(this.getCss(a,"height")));var e=a.offsetWidth;return"undefined"==typeof a.offsetWidth&&(e=parseInt(this.getCss(a,"width"))),{top:b,left:c,width:e,height:d}},Miniscroll[a].getZindex=function(a){for(var b=0,c=0,d=0,e=a.getElementsByTagName("*"),f=0;f<e.length;f++)d=this.getCss(e[f],"position"),e[f].style.position="relative",c=Number(this.getCss(e[f],"z-index")),e[f].style.position=d,c>b&&(b=c+1);return b},Miniscroll[a].mouse=function(a){var b=0,c=0;return a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}},Miniscroll[a].bind=function(a,b,c){var d="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e=this;a.addEventListener?"mousewheel"===b?a.addEventListener(d,function(a){c.call(e,a,this)},!1):a.addEventListener(b,function(a){c.call(e,a,this)},!1):a.attachEvent?a.attachEvent("on"+b,function(a){c.call(e,a,this)}):a["on"+b]=function(a){c.call(e,a,this)}},Miniscroll[a].unbind=function(a,b,c){var d="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";a.addEventListener?"mousewheel"===b?(a.removeEventListener(d,function(a){c.call(_this,a,this)},!1),a.addEventListener("MozMousePixelScroll",function(a){c.call(_this,a,this)},!1)):a.removeEventListener(b,function(a){c.call(_this,a,this)},!1):a.attachEvent?a.detachEvent("on"+b,function(a){c.call(_this,a,this)}):a["on"+b]=null},Miniscroll[a].stopEvent=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault?a.preventDefault():a.returnValue=!1},Miniscroll});